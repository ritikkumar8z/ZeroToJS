<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChronoVault - Time Capsule Platform</title>
    <meta name="description" content="Create digital time capsules for your future self. Lock messages, memories, and media until a future date.">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { 
            --primary-bg: #0a0a0f;
            --secondary-bg: rgba(15, 15, 25, 0.8); 
            --accent-color: #00d4ff;   
            --accent-secondary: #7c3aed;   
            --text-primary: #ffffff;  
            --text-secondary: #a1a1aa;  
            --glass-bg: rgba(255, 255, 255, 0.05);      
            --glass-border: rgba(255, 255, 255, 0.1); 
            --success-color: #10b981; 
            --warning-color: #f59e0b; 
            --error-color: #ef4444;
            --shadow-glow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        [data-theme="light"] {
            --primary-bg: #f8fafc;
            --secondary-bg: rgba(255, 255, 255, 0.8);
            --accent-color: #0ea5e9;
            --accent-secondary: #8b5cf6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 0 30px rgba(14, 165, 233, 0.3);
        }

        [data-theme="futuristic"] {
            --primary-bg: #000;
            --secondary-bg: rgba(0, 20, 40, 0.9);
            --accent-color: #00ff88;
            --accent-secondary: #ff0080;
            --text-primary: #00ff88;
            --text-secondary: #80ffcc;
            --glass-bg: rgba(0, 255, 136, 0.05);
            --glass-border: rgba(0, 255, 136, 0.2);
            --shadow-glow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            cursor: none;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Custom Cursor */
        .cursor {
            position: fixed;
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            transition: transform 0.1s ease;
            mix-blend-mode: difference;
        }

        .cursor-dot {
            position: fixed;
            width: 4px;
            height: 4px;
            background: var(--accent-color);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10001;
            transition: transform 0.05s ease;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            background: var(--accent-color);
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .nebula {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
            animation: nebulaFloat 10s ease-in-out infinite alternate;
        }

        @keyframes nebulaFloat {
            0% { transform: translateX(-20px) translateY(-10px); }
            100% { transform: translateX(20px) translateY(10px); }
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 15px 30px;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-glow);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 30px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 16px;
            border-radius: 20px;
        }

        .nav-links a:hover {
            color: var(--accent-color);
            transform: translateY(-2px);
            background: var(--glass-bg);
        }

        .nav-links a.active {
            background: var(--accent-color);
            color: var(--primary-bg);
        }

        .theme-toggle {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 8px 15px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .theme-toggle:hover {
            background: var(--accent-color);
            color: var(--primary-bg);
            transform: scale(1.1);
        }

        .mobile-menu {
            display: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-primary);
        }

        /* Page Sections */
        .page {
            min-height: 100vh;
            display: none;
            padding: 100px 20px 50px;
        }

        .page.active {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Home Page Styles */
        .hero {
            text-align: center;
            padding: 100px 0;
            position: relative;
        }

        .hero h1 {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px var(--accent-color)); }
            to { filter: drop-shadow(0 0 30px var(--accent-secondary)); }
        }

        .hero p {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-family: 'Inter', sans-serif;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 60px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            color: white;
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-glow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* Glass Cards */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .feature-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-glow);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            display: block;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-family: 'Inter', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .form-control::placeholder {
            color: var(--text-secondary);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Capsule Cards */
        .capsule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .capsule-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .capsule-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        .capsule-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-locked {
            background: var(--warning-color);
            color: white;
        }

        .status-unlocked {
            background: var(--success-color);
            color: white;
        }

        .status-public {
            background: var(--accent-color);
            color: white;
        }

        .countdown {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-color);
            margin: 15px 0;
            font-family: 'Inter', monospace;
            background: var(--glass-bg);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .capsule-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .capsule-actions .btn {
            flex: 1;
            justify-content: center;
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--error-color);
        }

        /* Animations */
        .lock-animation {
            animation: lockPulse 2s ease-in-out infinite;
        }

        @keyframes lockPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        }

        .unlock-animation {
            animation: unlockGlow 1s ease-out;
        }

        @keyframes unlockGlow {
            0% { 
                box-shadow: 0 0 0 rgba(16, 185, 129, 0.5);
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.8);
                transform: scale(1.05);
            }
            100% { 
                box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
                transform: scale(1);
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--glass-border);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
        }

        .message-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .message-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }

        /* Time Flow Effect */
        .time-flow {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .flow-line {
            position: absolute;
            width: 2px;
            height: 100px;
            background: linear-gradient(to bottom, transparent, var(--accent-color), transparent);
            animation: flow 4s linear infinite;
        }

        @keyframes flow {
            0% { transform: translateY(-100px); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        /* Media Preview */
        .media-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: var(--glass-bg);
            border: 2px dashed var(--glass-border);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload:hover .file-upload-label {
            border-color: var(--accent-color);
            background: rgba(0, 212, 255, 0.05);
        }

        .media-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .media-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: var(--glass-bg);
        }

        .media-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--glass-bg);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary));
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .navbar {
                width: 90%;
                padding: 15px 20px;
            }

            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                flex-direction: column;
                background: var(--glass-bg);
                backdrop-filter: blur(20px);
                border-radius: 15px;
                padding: 20px;
                margin-top: 10px;
                gap: 15px;
            }

            .nav-links.mobile-active {
                display: flex;
            }

            .mobile-menu {
                display: block;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .capsule-grid {
                grid-template-columns: 1fr;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .page {
                padding: 120px 10px 30px;
            }

            .container {
                padding: 0 10px;
            }

            .glass-card {
                padding: 20px;
            }

            .modal-content {
                padding: 30px 20px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--glass-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }

        /* Audio Visualizer */
        .audio-visualizer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            height: 40px;
            margin: 10px 0;
        }

        .audio-bar {
            width: 3px;
            background: var(--accent-color);
            border-radius: 2px;
            animation: audioWave 1s ease-in-out infinite alternate;
        }

        @keyframes audioWave {
            0% { height: 10px; }
            100% { height: 30px; }
        }

        .audio-bar:nth-child(2) { animation-delay: 0.1s; }
        .audio-bar:nth-child(3) { animation-delay: 0.2s; }
        .audio-bar:nth-child(4) { animation-delay: 0.3s; }
        .audio-bar:nth-child(5) { animation-delay: 0.4s; }
    </style>
</head>
<body data-theme="dark">
    <!-- Custom Cursor -->
    <div class="cursor"></div>
    <div class="cursor-dot"></div>

    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="nebula"></div>
        <div class="stars"></div>
        <div class="time-flow"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <ul class="nav-links">
            <li><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" class="nav-link" data-page="create"><i class="fas fa-plus"></i> Create</a></li>
            <li><a href="#" class="nav-link" data-page="capsules"><i class="fas fa-archive"></i> My Capsules</a></li>
            <li><a href="#" class="nav-link" data-page="gallery"><i class="fas fa-globe"></i> Gallery</a></li>
            <li><a href="#" class="nav-link" data-page="settings"><i class="fas fa-cog"></i> Settings</a></li>
            <li><button class="theme-toggle" id="themeToggle">🌙</button></li>
        </ul>
        <div class="mobile-menu" id="mobileMenu">
            <i class="fas fa-bars"></i>
        </div>
    </nav>

    <!-- Home Page -->
    <div class="page active" id="home">
        <div class="container">
            <div class="hero">
                <h1>ChronoVault</h1>
                <p>Lock your memories in time. Unlock them when the moment is right.</p>
                <div class="cta-buttons">
                    <a href="#" class="btn btn-primary nav-link" data-page="create">
                        <i class="fas fa-plus"></i> Create Time Capsule
                    </a>
                    <a href="#" class="btn btn-secondary nav-link" data-page="capsules">
                        <i class="fas fa-archive"></i> View My Capsules
                    </a>
                </div>
            </div>

            <div class="glass-card">
                <h2 style="margin-bottom: 20px; color: var(--accent-color);">What is ChronoVault?</h2>
                <p style="line-height: 1.8; font-size: 1.1rem;">ChronoVault is your personal time machine. Create digital time capsules containing messages, photos, videos, or audio recordings that will be locked until a future date you choose. Write letters to your future self, preserve memories for loved ones, or create public capsules for the world to discover.</p>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <i class="fas fa-lock feature-icon"></i>
                    <h3 style="margin-bottom: 15px;">Time-Locked Security</h3>
                    <p>Your capsules remain securely locked until your chosen unlock date arrives. No early access possible!</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-photo-video feature-icon"></i>
                    <h3 style="margin-bottom: 15px;">Rich Media Support</h3>
                    <p>Include text, images, audio recordings, and videos in your time capsules for the complete experience.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-globe feature-icon"></i>
                    <h3 style="margin-bottom: 15px;">Public Gallery</h3>
                    <p>Share your unlocked capsules with the world or keep them private. Connect with others through time.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Capsule Page -->
    <div class="page" id="create">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 40px; font-size: 3rem; color: var(--accent-color);">Create Time Capsule</h1>
            
            <div class="glass-card" style="max-width: 800px; margin: 0 auto;">
                <form id="createCapsuleForm">
                    <div class="form-group">
                        <label for="capsuleTitle"><i class="fas fa-heading"></i> Capsule Title</label>
                        <input type="text" id="capsuleTitle" class="form-control" required placeholder="Give your time capsule a meaningful title..." maxlength="100">
                    </div>

                    <div class="form-group">
                        <label for="capsuleMessage"><i class="fas fa-envelope"></i> Message</label>
                        <textarea id="capsuleMessage" class="form-control" required placeholder="Write your message to the future..." maxlength="5000"></textarea>
                        <small style="color: var(--text-secondary); font-size: 0.9rem;">Characters: <span id="charCount">0/5000</span></small>
                    </div>

                    <div class="form-group">
                        <label for="capsuleMedia"><i class="fas fa-paperclip"></i> Attach Media (Optional)</label>
                        <div class="file-upload">
                            <input type="file" id="capsuleMedia" accept="image/*,video/*,audio/*" multiple>
                            <div class="file-upload-label">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 5px;">Click to upload media</div>
                                    <small style="color: var(--text-secondary);">Images, videos, or audio files</small>
                                </div>
                            </div>
                        </div>
                        <div id="mediaPreview" class="media-preview-container"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="unlockDate"><i class="fas fa-calendar-alt"></i> Unlock Date & Time</label>
                            <input type="datetime-local" id="unlockDate" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="visibility"><i class="fas fa-eye"></i> Visibility</label>
                            <select id="visibility" class="form-control">
                                <option value="private">🔒 Private (Only you can see)</option>
                                <option value="public">🌍 Public (Visible in gallery when unlocked)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="password"><i class="fas fa-key"></i> Password Protection (Optional)</label>
                        <input type="password" id="password" class="form-control" placeholder="Add password for extra security..." maxlength="50">
                        <small style="color: var(--text-secondary); font-size: 0.9rem;">Leave empty for no password protection</small>
                    </div>

                    <div class="form-group">
                        <label for="category"><i class="fas fa-tag"></i> Category</label>
                        <select id="category" class="form-control">
                            <option value="personal">💭 Personal Reflection</option>
                            <option value="memories">📸 Memories</option>
                            <option value="goals">🎯 Goals & Dreams</option>
                            <option value="love">💝 Love Letter</option>
                            <option value="family">👨‍👩‍👧‍👦 Family</option>
                            <option value="other">📦 Other</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="createBtn">
                        <i class="fas fa-lock"></i> Create Time Capsule
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- My Capsules Page -->
    <div class="page" id="capsules">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
                <h1 style="font-size: 3rem; color: var(--accent-color); margin: 0;">My Time Capsules</h1>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <select id="capsuleFilter" class="form-control" style="width: auto;">
                        <option value="all">All Capsules</option>
                        <option value="locked">Locked Only</option>
                        <option value="unlocked">Unlocked Only</option>
                        <option value="public">Public Only</option>
                        <option value="private">Private Only</option>
                    </select>
                    <select id="capsuleSort" class="form-control" style="width: auto;">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="unlock-soon">Unlock Soon</option>
                        <option value="unlock-far">Unlock Later</option>
                    </select>
                </div>
            </div>
            
            <div id="capsulesContainer">
                <div class="capsule-grid" id="capsulesGrid">
                    <!-- Capsules will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Capsule Viewer Page -->
    <div class="page" id="viewer">
        <div class="container">
            <div class="glass-card" style="max-width: 900px; margin: 0 auto;">
                <div id="capsuleContent">
                    <!-- Capsule content will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Public Gallery Page -->
    <div class="page" id="gallery">
        <div class="container">
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 style="font-size: 3rem; color: var(--accent-color); margin-bottom: 20px;">Public Gallery</h1>
                <p style="font-size: 1.2rem; color: var(--text-secondary); max-width: 600px; margin: 0 auto;">
                    Discover time capsules from people around the world. Each one is a unique message from the past to the present.
                </p>
            </div>
            
            <div style="display: flex; justify-content: center; margin-bottom: 30px;">
                <select id="galleryFilter" class="form-control" style="width: auto;">
                    <option value="all">All Categories</option>
                    <option value="personal">Personal Reflection</option>
                    <option value="memories">Memories</option>
                    <option value="goals">Goals & Dreams</option>
                    <option value="love">Love Letters</option>
                    <option value="family">Family</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="capsule-grid" id="publicGallery">
                <!-- Public capsules will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div class="page" id="settings">
        <div class="container">
            <h1 style="text-align: center; margin-bottom: 40px; font-size: 3rem; color: var(--accent-color);">Settings</h1>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px;">
                <!-- Theme Settings -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-palette"></i> Theme Settings
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                        <button class="btn btn-secondary theme-btn" data-theme="dark">
                            <i class="fas fa-moon"></i> Dark
                        </button>
                        <button class="btn btn-secondary theme-btn" data-theme="light">
                            <i class="fas fa-sun"></i> Light
                        </button>
                        <button class="btn btn-secondary theme-btn" data-theme="futuristic">
                            <i class="fas fa-rocket"></i> Futuristic
                        </button>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 15px;">
                        Choose your preferred visual theme. Changes apply instantly.
                    </p>
                </div>

                <!-- Notifications -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-bell"></i> Notifications
                    </h3>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="unlockNotifications" checked>
                            <span>Notify when capsules unlock</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="reminderNotifications" checked>
                            <span>Reminder notifications (1 day before)</span>
                        </label>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 15px;">
                        Browser notifications will alert you when capsules are ready to unlock.
                    </p>
                </div>

                <!-- Statistics -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-bar"></i> Your Statistics
                    </h3>
                    <div id="userStats">
                        <!-- Stats will be populated here -->
                    </div>
                </div>

                <!-- Data Management -->
                <div class="glass-card">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-database"></i> Data Management
                    </h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <button class="btn btn-secondary" id="exportData">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn btn-secondary" id="importData">
                            <i class="fas fa-upload"></i> Import Data
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                        <button class="btn" style="background: var(--error-color); color: white;" id="clearData">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 15px;">
                        Backup your capsules or start fresh. Export creates a JSON file with all your data.
                    </p>
                </div>
            </div>

            <!-- About Section -->
            <div class="glass-card" style="margin-top: 30px; text-align: center;">
                <h3 style="margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-info-circle"></i> About ChronoVault
                </h3>
                <p style="color: var(--text-secondary); line-height: 1.8; font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                    ChronoVault v2.0 - A futuristic time capsule platform for preserving your memories and messages for the future. 
                    Built with love using vanilla HTML, CSS, and JavaScript. Your data stays private and secure in your browser.
                </p>
                <div style="margin-top: 20px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <span style="color: var(--accent-color);">
                        <i class="fas fa-code"></i> Open Source
                    </span>
                    <span style="color: var(--accent-color);">
                        <i class="fas fa-shield-alt"></i> Privacy First
                    </span>
                    <span style="color: var(--accent-color);">
                        <i class="fas fa-mobile-alt"></i> Mobile Friendly
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('successModal')">&times;</button>
            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success-color); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 15px;">Success!</h2>
            <p id="successMessage" style="margin-bottom: 30px;">Your time capsule has been created successfully!</p>
            <button class="btn btn-primary" onclick="closeModal('successModal')">
                <i class="fas fa-thumbs-up"></i> Awesome!
            </button>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('errorModal')">&times;</button>
            <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: var(--error-color); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 15px;">Oops!</h2>
            <p id="errorMessage" style="margin-bottom: 30px;">Something went wrong. Please try again.</p>
            <button class="btn btn-primary" onclick="closeModal('errorModal')">
                <i class="fas fa-redo"></i> Try Again
            </button>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('passwordModal')">&times;</button>
            <i class="fas fa-key" style="font-size: 4rem; color: var(--accent-color); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 15px;">Password Required</h2>
            <p style="margin-bottom: 20px;">This capsule is password protected. Enter the password to unlock.</p>
            <input type="password" id="passwordInput" class="form-control" placeholder="Enter password..." style="margin-bottom: 20px;">
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-primary" onclick="verifyPassword()">
                    <i class="fas fa-unlock"></i> Unlock
                </button>
                <button class="btn btn-secondary" onclick="closeModal('passwordModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('confirmModal')">&times;</button>
            <i class="fas fa-question-circle" style="font-size: 4rem; color: var(--warning-color); margin-bottom: 20px;"></i>
            <h2 style="margin-bottom: 15px;">Are you sure?</h2>
            <p id="confirmMessage" style="margin-bottom: 30px;">This action cannot be undone.</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-primary" id="confirmYes">
                    <i class="fas fa-check"></i> Yes
                </button>
                <button class="btn btn-secondary" onclick="closeModal('confirmModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let currentPage = 'home';
        let capsules = JSON.parse(localStorage.getItem('chronovault_capsules') || '[]');
        let currentTheme = localStorage.getItem('chronovault_theme') || 'dark';
        let selectedCapsule = null;
        let mediaFiles = [];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupCustomCursor();
            setupAnimatedBackground();
            setupNavigation();
            setupTheme();
            setupForms();
            loadCapsules();
            startCountdownTimers();
            setupTimeFlowEffect();
            updateUserStats();
            requestNotificationPermission();
            checkForUnlockedCapsules();
        }

        // Custom Cursor
        function setupCustomCursor() {
            const cursor = document.querySelector('.cursor');
            const cursorDot = document.querySelector('.cursor-dot');
            
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX - 10 + 'px';
                cursor.style.top = e.clientY - 10 + 'px';
                cursorDot.style.left = e.clientX - 2 + 'px';
                cursorDot.style.top = e.clientY - 2 + 'px';
            });

            // Cursor effects on hover
            document.querySelectorAll('a, button, .capsule-card, input, textarea, select').forEach(el => {
                el.addEventListener('mouseenter', () => {
                    cursor.style.transform = 'scale(1.5)';
                    cursorDot.style.transform = 'scale(2)';
                });
                el.addEventListener('mouseleave', () => {
                    cursor.style.transform = 'scale(1)';
                    cursorDot.style.transform = 'scale(1)';
                });
            });
        }

        // Animated Background
        function setupAnimatedBackground() {
            const starsContainer = document.querySelector('.stars');
            
            // Create stars
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                star.style.animationDuration = (Math.random() * 3 + 1) + 's';
                starsContainer.appendChild(star);
            }
        }

        // Time Flow Effect
        function setupTimeFlowEffect() {
            const timeFlow = document.querySelector('.time-flow');
            
            function createFlowLine() {
                const line = document.createElement('div');
                line.className = 'flow-line';
                line.style.left = Math.random() * 100 + '%';
                line.style.animationDelay = Math.random() * 2 + 's';
                line.style.animationDuration = (Math.random() * 2 + 3) + 's';
                timeFlow.appendChild(line);
                
                setTimeout(() => {
                    if (line.parentNode) {
                        line.remove();
                    }
                }, 5000);
            }

            // Create initial lines
            for (let i = 0; i < 5; i++) {
                setTimeout(createFlowLine, i * 200);
            }

            // Continue creating lines
            setInterval(createFlowLine, 1000);
        }

        // Navigation
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const mobileMenu = document.getElementById('mobileMenu');
            const navLinksContainer = document.querySelector('.nav-links');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    if (page) {
                        navigateToPage(page);
                        
                        // Update active nav link
                        navLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        
                        // Close mobile menu
                        navLinksContainer.classList.remove('mobile-active');
                    }
                });
            });

            // Mobile menu toggle
            mobileMenu.addEventListener('click', () => {
                navLinksContainer.classList.toggle('mobile-active');
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.navbar')) {
                    navLinksContainer.classList.remove('mobile-active');
                }
            });
        }

        function navigateToPage(page) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.classList.remove('active'));
            
            const targetPage = document.getElementById(page);
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = page;
                
                // Load page-specific content
                if (page === 'capsules') {
                    loadCapsules();
                } else if (page === 'gallery') {
                    loadPublicGallery();
                } else if (page === 'settings') {
                    updateUserStats();
                }
            }
        }

        // Theme System
        function setupTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const themeButtons = document.querySelectorAll('.theme-btn');
            
            // Apply saved theme
            document.body.dataset.theme = currentTheme;
            updateThemeToggleIcon();
            updateActiveThemeButton();
            
            themeToggle.addEventListener('click', () => {
                const themes = ['dark', 'light', 'futuristic'];
                const currentIndex = themes.indexOf(currentTheme);
                currentTheme = themes[(currentIndex + 1) % themes.length];
                
                applyTheme(currentTheme);
            });

            themeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    applyTheme(theme);
                });
            });
        }

        function applyTheme(theme) {
            currentTheme = theme;
            document.body.dataset.theme = theme;
            localStorage.setItem('chronovault_theme', theme);
            updateThemeToggleIcon();
            updateActiveThemeButton();
        }

        function updateThemeToggleIcon() {
            const themeToggle = document.getElementById('themeToggle');
            const icons = { dark: '🌙', light: '☀️', futuristic: '🚀' };
            themeToggle.textContent = icons[currentTheme] || '🌙';
        }

        function updateActiveThemeButton() {
            const themeButtons = document.querySelectorAll('.theme-btn');
            themeButtons.forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
                if (btn.dataset.theme === currentTheme) {
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-primary');
                }
            });
        }

        // Forms
        function setupForms() {
            const createForm = document.getElementById('createCapsuleForm');
            const mediaInput = document.getElementById('capsuleMedia');
            const mediaPreview = document.getElementById('mediaPreview');
            const messageTextarea = document.getElementById('capsuleMessage');
            const charCount = document.getElementById('charCount');

            // Set minimum date to current time + 1 minute
            const now = new Date();
            now.setMinutes(now.getMinutes() + 1);
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('unlockDate').min = now.toISOString().slice(0, 16);

            // Character counter
            messageTextarea.addEventListener('input', () => {
                const count = messageTextarea.value.length;
                charCount.textContent = `${count}/5000`;
                charCount.style.color = count > 4500 ? 'var(--error-color)' : 'var(--text-secondary)';
            });

            createForm.addEventListener('submit', handleCreateCapsule);

            mediaInput.addEventListener('change', handleMediaUpload);

            // Setup filters and sorting
            setupFiltersAndSorting();

            // Setup settings
            setupSettings();
        }

        function handleMediaUpload(e) {
            const mediaPreview = document.getElementById('mediaPreview');
            const files = Array.from(e.target.files);
            
            mediaFiles = []; // Reset media files
            mediaPreview.innerHTML = '';

            if (files.length === 0) return;

            files.forEach((file, index) => {
                // Check file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showModal('errorModal', `File "${file.name}" is too large. Maximum size is 10MB.`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const mediaItem = {
                        name: file.name,
                        type: file.type,
                        data: e.target.result,
                        size: file.size
                    };
                    mediaFiles.push(mediaItem);

                    const preview = document.createElement('div');
                    preview.className = 'media-item';
                    
                    let mediaElement = '';
                    if (file.type.startsWith('image/')) {
                        mediaElement = `<img src="${e.target.result}" class="media-preview" alt="${file.name}">`;
                    } else if (file.type.startsWith('video/')) {
                        mediaElement = `<video src="${e.target.result}" class="media-preview" controls></video>`;
                    } else if (file.type.startsWith('audio/')) {
                        mediaElement = `
                            <div style="padding: 20px; text-align: center; background: var(--glass-bg);">
                                <i class="fas fa-music" style="font-size: 2rem; color: var(--accent-color); margin-bottom: 10px;"></i>
                                <div style="font-weight: 600; margin-bottom: 10px;">${file.name}</div>
                                <audio src="${e.target.result}" controls style="width: 100%;"></audio>
                                <div class="audio-visualizer">
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                </div>
                            </div>
                        `;
                    }
                    
                    preview.innerHTML = `
                        ${mediaElement}
                        <button class="media-remove" onclick="removeMedia(${index})" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    mediaPreview.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeMedia(index) {
            mediaFiles.splice(index, 1);
            const mediaPreview = document.getElementById('mediaPreview');
            const mediaItems = mediaPreview.querySelectorAll('.media-item');
            if (mediaItems[index]) {
                mediaItems[index].remove();
            }
            
            // Update indices for remaining items
            const remainingItems = mediaPreview.querySelectorAll('.media-remove');
            remainingItems.forEach((btn, i) => {
                btn.setAttribute('onclick', `removeMedia(${i})`);
            });
        }

        // Create Capsule
        function handleCreateCapsule(e) {
            e.preventDefault();
            
            const createBtn = document.getElementById('createBtn');
            createBtn.disabled = true;
            createBtn.innerHTML = '<div class="loading"></div> Creating...';
            
            const title = document.getElementById('capsuleTitle').value.trim();
            const message = document.getElementById('capsuleMessage').value.trim();
            const unlockDate = new Date(document.getElementById('unlockDate').value);
            const visibility = document.getElementById('visibility').value;
            const password = document.getElementById('password').value.trim();
            const category = document.getElementById('category').value;

            // Validate unlock date
            if (unlockDate <= new Date()) {
                showModal('errorModal', 'Please select a future date and time for your time capsule.');
                resetCreateButton();
                return;
            }

            // Create capsule object
            const capsule = {
                id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                title,
                message,
                unlockDate: unlockDate.toISOString(),
                visibility,
                password,
                category,
                media: [...mediaFiles], // Copy media files
                createdAt: new Date().toISOString(),
                isLocked: true
            };

            capsules.push(capsule);
            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
            
            // Reset form
            document.getElementById('createCapsuleForm').reset();
            document.getElementById('mediaPreview').innerHTML = '';
            document.getElementById('charCount').textContent = '0/5000';
            mediaFiles = [];
            
            // Reset minimum date
            const now = new Date();
            now.setMinutes(now.getMinutes() + 1 - now.getTimezoneOffset());
            document.getElementById('unlockDate').min = now.toISOString().slice(0, 16);
            
            resetCreateButton();
            showModal('successModal', 
                `Your time capsule "${title}" has been created and locked until ${unlockDate.toLocaleDateString()} at ${unlockDate.toLocaleTimeString()}!`
            );

            // Schedule notification
            scheduleNotification(capsule);
        }

        function resetCreateButton() {
            const createBtn = document.getElementById('createBtn');
            createBtn.disabled = false;
            createBtn.innerHTML = '<i class="fas fa-lock"></i> Create Time Capsule';
        }

        // Load Capsules with Filtering and Sorting
        function loadCapsules() {
            const grid = document.getElementById('capsulesGrid');
            const filter = document.getElementById('capsuleFilter')?.value || 'all';
            const sort = document.getElementById('capsuleSort')?.value || 'newest';

            // Filter capsules
            let filteredCapsules = capsules.filter(capsule => {
                const now = new Date();
                const unlockDate = new Date(capsule.unlockDate);
                const isUnlocked = now >= unlockDate;
                
                // Update locked status
                if (isUnlocked && capsule.isLocked) {
                    capsule.isLocked = false;
                }

                switch (filter) {
                    case 'locked': return capsule.isLocked;
                    case 'unlocked': return !capsule.isLocked;
                    case 'public': return capsule.visibility === 'public';
                    case 'private': return capsule.visibility === 'private';
                    default: return true;
                }
            });

            // Sort capsules
            filteredCapsules.sort((a, b) => {
                switch (sort) {
                    case 'oldest':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'unlock-soon':
                        return new Date(a.unlockDate) - new Date(b.unlockDate);
                    case 'unlock-far':
                        return new Date(b.unlockDate) - new Date(a.unlockDate);
                    default: // newest
                        return new Date(b.createdAt) - new Date(a.createdAt);
                }
            });

            grid.innerHTML = '';

            if (filteredCapsules.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-hourglass-empty"></i>
                        <h3>No Capsules Found</h3>
                        <p>${filter === 'all' ? 'Create your first time capsule to get started!' : 'No capsules match your current filter.'}</p>
                        ${filter === 'all' ? '<button class="btn btn-primary nav-link" data-page="create"><i class="fas fa-plus"></i> Create Capsule</button>' : ''}
                    </div>
                `;
                return;
            }

            filteredCapsules.forEach(capsule => {
                const unlockDate = new Date(capsule.unlockDate);
                const now = new Date();
                const isUnlocked = now >= unlockDate;
                
                const categoryIcons = {
                    personal: '💭',
                    memories: '📸',
                    goals: '🎯',
                    love: '💝',
                    family: '👨‍👩‍👧‍👦',
                    other: '📦'
                };

                const timeUntilUnlock = unlockDate - now;
                const progress = isUnlocked ? 100 : Math.max(0, 100 - (timeUntilUnlock / (24 * 60 * 60 * 1000)) * 2); // Rough progress calculation

                const card = document.createElement('div');
                card.className = 'capsule-card';
                if (!isUnlocked) card.classList.add('lock-animation');
                
                card.innerHTML = `
                    <div class="capsule-status ${isUnlocked ? 'status-unlocked' : 'status-locked'}">
                        ${isUnlocked ? 'Unlocked' : 'Locked'}
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 1.5rem;">${categoryIcons[capsule.category] || '📦'}</span>
                        <h3 style="margin: 0; flex: 1;">${capsule.title}</h3>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin: 10px 0; font-size: 0.9rem;">
                        Created: ${new Date(capsule.createdAt).toLocaleDateString()}
                    </p>
                    
                    <p style="color: var(--text-secondary); margin: 10px 0; font-size: 0.9rem;">
                        Unlock: ${unlockDate.toLocaleDateString()} at ${unlockDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                    </p>
                    
                    ${capsule.media && capsule.media.length > 0 ? `
                        <div style="display: flex; align-items: center; gap: 5px; margin: 10px 0; color: var(--text-secondary); font-size: 0.9rem;">
                            <i class="fas fa-paperclip"></i>
                            <span>${capsule.media.length} attachment${capsule.media.length > 1 ? 's' : ''}</span>
                        </div>
                    ` : ''}
                    
                    ${capsule.password ? `
                        <div style="display: flex; align-items: center; gap: 5px; margin: 10px 0; color: var(--warning-color); font-size: 0.9rem;">
                            <i class="fas fa-key"></i>
                            <span>Password protected</span>
                        </div>
                    ` : ''}
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                    
                    <div class="countdown" data-unlock="${capsule.unlockDate}">
                        ${isUnlocked ? '🎉 Ready to view!' : 'Calculating...'}
                    </div>
                    
                    <div class="capsule-actions">
                        <button class="btn ${isUnlocked ? 'btn-primary' : 'btn-secondary'}" 
                                onclick="viewCapsule('${capsule.id}')" 
                                ${isUnlocked ? '' : 'disabled'}>
                            <i class="fas fa-${isUnlocked ? 'unlock' : 'lock'}"></i>
                            ${isUnlocked ? 'View' : 'Locked'}
                        </button>
                        <button class="btn btn-secondary" onclick="editCapsule('${capsule.id}')" 
                                ${isUnlocked ? 'disabled' : ''} title="${isUnlocked ? 'Cannot edit unlocked capsules' : 'Edit capsule'}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-secondary" onclick="confirmDelete('${capsule.id}')" title="Delete capsule">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                if (isUnlocked && capsule.isLocked) {
                    card.classList.add('unlock-animation');
                    // Send notification if enabled
                    if (Notification.permission === 'granted' && document.getElementById('unlockNotifications')?.checked) {
                        new Notification('🎉 Time Capsule Unlocked!', {
                            body: `Your capsule "${capsule.title}" is now ready to view!`,
                            icon: '/favicon.ico'
                        });
                    }
                }
                
                grid.appendChild(card);
            });

            // Update localStorage with any status changes
            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
        }

        // Load Public Gallery
        function loadPublicGallery() {
            const gallery = document.getElementById('publicGallery');
            const filter = document.getElementById('galleryFilter')?.value || 'all';
            
            let publicCapsules = capsules.filter(c => {
                const now = new Date();
                const unlockDate = new Date(c.unlockDate);
                const isUnlocked = now >= unlockDate;
                
                if (isUnlocked) c.isLocked = false;
                
                const matchesFilter = filter === 'all' || c.category === filter;
                return c.visibility === 'public' && !c.isLocked && matchesFilter;
            });
            
            // Sort by unlock date (most recent first)
            publicCapsules.sort((a, b) => new Date(b.unlockDate) - new Date(a.unlockDate));
            
            gallery.innerHTML = '';

            if (publicCapsules.length === 0) {
                gallery.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-globe"></i>
                        <h3>No Public Capsules Available</h3>
                        <p>${filter === 'all' ? 'Check back later for more unlocked public capsules!' : 'No public capsules found for this category.'}</p>
                    </div>
                `;
                return;
            }

            const categoryIcons = {
                personal: '💭', memories: '📸', goals: '🎯', 
                love: '💝', family: '👨‍👩‍👧‍👦', other: '📦'
            };

            publicCapsules.forEach(capsule => {
                const card = document.createElement('div');
                card.className = 'capsule-card';
                card.innerHTML = `
                    <div class="capsule-status status-public">Public</div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <span style="font-size: 1.5rem;">${categoryIcons[capsule.category] || '📦'}</span>
                        <h3 style="margin: 0; flex: 1;">${capsule.title}</h3>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin: 10px 0; font-size: 0.9rem;">
                        Unlocked: ${new Date(capsule.unlockDate).toLocaleDateString()}
                    </p>
                    
                    <p style="color: var(--text-secondary); margin: 10px 0; font-size: 0.9rem; line-height: 1.4;">
                        ${capsule.message.length > 100 ? capsule.message.substring(0, 100) + '...' : capsule.message}
                    </p>
                    
                    ${capsule.media && capsule.media.length > 0 ? `
                        <div style="display: flex; align-items: center; gap: 5px; margin: 10px 0; color: var(--accent-color); font-size: 0.9rem;">
                            <i class="fas fa-photo-video"></i>
                            <span>Contains media</span>
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-primary" onclick="viewCapsule('${capsule.id}')" style="width: 100%; margin-top: 15px;">
                        <i class="fas fa-eye"></i> View Capsule
                    </button>
                `;
                gallery.appendChild(card);
            });
        }

        // View Capsule
        function viewCapsule(capsuleId) {
            const capsule = capsules.find(c => c.id === capsuleId);
            if (!capsule) return;

            const now = new Date();
            const unlockDate = new Date(capsule.unlockDate);

            if (now < unlockDate) {
                showModal('errorModal', `This capsule is still locked until ${unlockDate.toLocaleDateString()} at ${unlockDate.toLocaleTimeString()}.`);
                return;
            }

            if (capsule.password) {
                selectedCapsule = capsule;
                showModal('passwordModal');
                return;
            }

            displayCapsule(capsule);
        }

        function verifyPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === selectedCapsule.password) {
                closeModal('passwordModal');
                displayCapsule(selectedCapsule);
                document.getElementById('passwordInput').value = '';
            } else {
                document.getElementById('passwordInput').style.borderColor = 'var(--error-color)';
                setTimeout(() => {
                    document.getElementById('passwordInput').style.borderColor = '';
                }, 1000);
                showModal('errorModal', 'Incorrect password. Please try again.');
            }
        }

        function displayCapsule(capsule) {
            const content = document.getElementById('capsuleContent');
            
            const categoryIcons = {
                personal: '💭', memories: '📸', goals: '🎯', 
                love: '💝', family: '👨‍👩‍👧‍👦', other: '📦'
            };

            let mediaHtml = '';
            if (capsule.media && capsule.media.length > 0) {
                mediaHtml = '<div style="margin: 30px 0;"><h4 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><i class="fas fa-paperclip"></i> Attached Media:</h4><div class="media-preview-container">';
                capsule.media.forEach(media => {
                    if (media.type.startsWith('image/')) {
                        mediaHtml += `<img src="${media.data}" class="media-preview" alt="${media.name}" style="cursor: pointer;" onclick="openMediaModal('${media.data}', '${media.name}', 'image')">`;
                    } else if (media.type.startsWith('video/')) {
                        mediaHtml += `<video src="${media.data}" class="media-preview" controls title="${media.name}"></video>`;
                    } else if (media.type.startsWith('audio/')) {
                        mediaHtml += `
                            <div class="media-item" style="padding: 20px; text-align: center;">
                                <i class="fas fa-music" style="font-size: 2rem; color: var(--accent-color); margin-bottom: 10px;"></i>
                                <div style="font-weight: 600; margin-bottom: 10px;">${media.name}</div>
                                <audio src="${media.data}" controls style="width: 100%;"></audio>
                                <div class="audio-visualizer">
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                    <div class="audio-bar"></div>
                                </div>
                            </div>
                        `;
                    }
                });
                mediaHtml += '</div></div>';
            }

            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 40px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">${categoryIcons[capsule.category] || '📦'}</div>
                    <i class="fas fa-unlock-alt" style="font-size: 3rem; color: var(--success-color); margin-bottom: 20px;"></i>
                    <h1 style="margin-bottom: 15px;">${capsule.title}</h1>
                    <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; color: var(--text-secondary); margin-bottom: 20px;">
                        <span><i class="fas fa-calendar-plus"></i> Created: ${new Date(capsule.createdAt).toLocaleDateString()}</span>
                        <span><i class="fas fa-unlock"></i> Unlocked: ${new Date(capsule.unlockDate).toLocaleDateString()}</span>
                        <span><i class="fas fa-${capsule.visibility === 'public' ? 'globe' : 'lock'}"></i> ${capsule.visibility === 'public' ? 'Public' : 'Private'}</span>
                    </div>
                </div>
                
                <div class="glass-card" style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-envelope-open"></i> Message:
                    </h3>
                    <div style="white-space: pre-wrap; line-height: 1.8; font-size: 1.1rem; font-family: 'Inter', sans-serif; padding: 20px; background: var(--glass-bg); border-radius: 15px; border: 1px solid var(--glass-border);">
                        ${capsule.message}
                    </div>
                    ${mediaHtml}
                </div>
                
                <div style="text-align: center; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="navigateToPage('capsules')">
                        <i class="fas fa-arrow-left"></i> Back to Capsules
                    </button>
                    ${capsule.visibility === 'private' ? `
                        <button class="btn btn-secondary" onclick="shareCapsule('${capsule.id}')">
                            <i class="fas fa-share"></i> Share
                        </button>
                    ` : ''}
                    <button class="btn btn-secondary" onclick="downloadCapsule('${capsule.id}')">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            `;
            
            navigateToPage('viewer');
        }

        // Edit Capsule (only for locked capsules)
        function editCapsule(capsuleId) {
            const capsule = capsules.find(c => c.id === capsuleId);
            if (!capsule || !capsule.isLocked) return;

            // Fill form with capsule data
            document.getElementById('capsuleTitle').value = capsule.title;
            document.getElementById('capsuleMessage').value = capsule.message;
            document.getElementById('unlockDate').value = capsule.unlockDate.slice(0, 16);
            document.getElementById('visibility').value = capsule.visibility;
            document.getElementById('password').value = capsule.password || '';
            document.getElementById('category').value = capsule.category;

            // Set media files
            mediaFiles = [...capsule.media];
            const mediaPreview = document.getElementById('mediaPreview');
            mediaPreview.innerHTML = '';
            
            capsule.media.forEach((media, index) => {
                const preview = document.createElement('div');
                preview.className = 'media-item';
                
                let mediaElement = '';
                if (media.type.startsWith('image/')) {
                    mediaElement = `<img src="${media.data}" class="media-preview" alt="${media.name}">`;
                } else if (media.type.startsWith('video/')) {
                    mediaElement = `<video src="${media.data}" class="media-preview" controls></video>`;
                } else if (media.type.startsWith('audio/')) {
                    mediaElement = `
                        <div style="padding: 20px; text-align: center; background: var(--glass-bg);">
                            <i class="fas fa-music" style="font-size: 2rem; color: var(--accent-color); margin-bottom: 10px;"></i>
                            <div style="font-weight: 600; margin-bottom: 10px;">${media.name}</div>
                            <audio src="${media.data}" controls style="width: 100%;"></audio>
                        </div>
                    `;
                }
                
                preview.innerHTML = `
                    ${mediaElement}
                    <button class="media-remove" onclick="removeMedia(${index})" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                mediaPreview.appendChild(preview);
            });

            // Delete original capsule
            capsules = capsules.filter(c => c.id !== capsuleId);
            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));

            // Navigate to create page
            navigateToPage('create');
            showModal('successModal', 'Capsule loaded for editing. Make your changes and create it again.');
        }

        // Delete Capsule with confirmation
        function confirmDelete(capsuleId) {
            const capsule = capsules.find(c => c.id === capsuleId);
            if (!capsule) return;

            document.getElementById('confirmMessage').textContent = `Are you sure you want to delete "${capsule.title}"? This action cannot be undone.`;
            document.getElementById('confirmYes').onclick = () => {
                deleteCapsule(capsuleId);
                closeModal('confirmModal');
            };
            showModal('confirmModal');
        }

        function deleteCapsule(capsuleId) {
            capsules = capsules.filter(c => c.id !== capsuleId);
            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
            loadCapsules();
            showModal('successModal', 'Time capsule deleted successfully.');
        }

        // Share Capsule
        function shareCapsule(capsuleId) {
            const capsule = capsules.find(c => c.id === capsuleId);
            if (!capsule) return;

            const shareData = {
                title: `Time Capsule: ${capsule.title}`,
                text: `Check out this time capsule I created: "${capsule.title}"`,
                url: window.location.href
            };

            if (navigator.share) {
                navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}\n${shareData.url}`)
                    .then(() => showModal('successModal', 'Capsule details copied to clipboard!'))
                    .catch(() => showModal('errorModal', 'Failed to copy to clipboard.'));
            }
        }

        // Download Capsule
        function downloadCapsule(capsuleId) {
            const capsule = capsules.find(c => c.id === capsuleId);
            if (!capsule) return;

            const data = {
                ...capsule,
                exportedAt: new Date().toISOString(),
                exportedBy: 'ChronoVault'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chronovault-${capsule.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Countdown Timers
        function startCountdownTimers() {
            updateCountdowns();
            setInterval(updateCountdowns, 1000);
        }

        function updateCountdowns() {
            const countdowns = document.querySelectorAll('.countdown');
            
            countdowns.forEach(countdown => {
                const unlockDate = new Date(countdown.dataset.unlock);
                const now = new Date();
                const diff = unlockDate - now;

                if (diff <= 0) {
                    countdown.textContent = '🎉 Ready to view!';
                    countdown.style.color = 'var(--success-color)';
                } else {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    if (days > 0) {
                        countdown.textContent = `${days}d ${hours}h ${minutes}m`;
                    } else if (hours > 0) {
                        countdown.textContent = `${hours}h ${minutes}m ${seconds}s`;
                    } else {
                        countdown.textContent = `${minutes}m ${seconds}s`;
                    }
                    
                    // Color coding based on time remaining
                    if (diff < 24 * 60 * 60 * 1000) { // Less than 24 hours
                        countdown.style.color = 'var(--warning-color)';
                    } else if (diff < 7 * 24 * 60 * 60 * 1000) { // Less than 7 days
                        countdown.style.color = 'var(--accent-secondary)';
                    } else {
                        countdown.style.color = 'var(--accent-color)';
                    }
                }
            });
        }

        // Filters and Sorting
        function setupFiltersAndSorting() {
            const capsuleFilter = document.getElementById('capsuleFilter');
            const capsuleSort = document.getElementById('capsuleSort');
            const galleryFilter = document.getElementById('galleryFilter');

            if (capsuleFilter) {
                capsuleFilter.addEventListener('change', loadCapsules);
            }
            if (capsuleSort) {
                capsuleSort.addEventListener('change', loadCapsules);
            }
            if (galleryFilter) {
                galleryFilter.addEventListener('change', loadPublicGallery);
            }
        }

        // Settings
        function setupSettings() {
            // Export data
            document.getElementById('exportData').addEventListener('click', () => {
                const data = {
                    capsules: capsules,
                    theme: currentTheme,
                    exportDate: new Date().toISOString(),
                    version: '2.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `chronovault-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showModal('successModal', 'Data exported successfully! Keep this file safe as your backup.');
            });

            // Import data
            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });

            document.getElementById('importFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.capsules && Array.isArray(data.capsules)) {
                            // Merge imported capsules with existing ones
                            const importedCapsules = data.capsules.filter(imported => 
                                !capsules.some(existing => existing.id === imported.id)
                            );
                            
                            capsules.push(...importedCapsules);
                            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
                            
                            if (data.theme) {
                                applyTheme(data.theme);
                            }
                            
                            loadCapsules();
                            showModal('successModal', `Successfully imported ${importedCapsules.length} capsules!`);
                        } else {
                            showModal('errorModal', 'Invalid backup file format.');
                        }
                    } catch (error) {
                        showModal('errorModal', 'Failed to read backup file. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            });

            // Clear data
            document.getElementById('clearData').addEventListener('click', () => {
                document.getElementById('confirmMessage').textContent = 'Are you sure you want to clear all data? This will delete all your time capsules permanently and cannot be undone.';
                document.getElementById('confirmYes').onclick = () => {
                    localStorage.removeItem('chronovault_capsules');
                    capsules = [];
                    loadCapsules();
                    closeModal('confirmModal');
                    showModal('successModal', 'All data cleared successfully.');
                };
                showModal('confirmModal');
            });
        }

        // User Statistics
        function updateUserStats() {
            const statsContainer = document.getElementById('userStats');
            if (!statsContainer) return;

            const now = new Date();
            const lockedCount = capsules.filter(c => c.isLocked).length;
            const unlockedCount = capsules.filter(c => !c.isLocked).length;
            const publicCount = capsules.filter(c => c.visibility === 'public').length;
            const privateCount = capsules.filter(c => c.visibility === 'private').length;
            const totalMedia = capsules.reduce((sum, c) => sum + (c.media ? c.media.length : 0), 0);
            
            // Next unlock
            const lockedCapsules = capsules.filter(c => c.isLocked);
            let nextUnlock = null;
            if (lockedCapsules.length > 0) {
                nextUnlock = lockedCapsules.reduce((earliest, capsule) => {
                    const unlockDate = new Date(capsule.unlockDate);
                    return unlockDate < new Date(earliest.unlockDate) ? capsule : earliest;
                });
            }

            statsContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 2rem; color: var(--accent-color); margin-bottom: 5px;">${capsules.length}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Total Capsules</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 2rem; color: var(--warning-color); margin-bottom: 5px;">${lockedCount}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Locked</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 2rem; color: var(--success-color); margin-bottom: 5px;">${unlockedCount}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Unlocked</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 2rem; color: var(--accent-secondary); margin-bottom: 5px;">${totalMedia}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Media Files</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 1.5rem; color: var(--accent-color); margin-bottom: 5px;">${publicCount}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Public</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: var(--glass-bg); border-radius: 10px;">
                        <div style="font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 5px;">${privateCount}</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Private</div>
                    </div>
                </div>
                
                ${nextUnlock ? `
                    <div style="margin-top: 20px; padding: 15px; background: var(--glass-bg); border-radius: 10px; text-align: center;">
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 5px;">Next Unlock:</div>
                        <div style="font-weight: 600; color: var(--accent-color);">${nextUnlock.title}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">${new Date(nextUnlock.unlockDate).toLocaleDateString()}</div>
                    </div>
                ` : ''}
            `;
        }

        // Notifications
        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function scheduleNotification(capsule) {
            if (Notification.permission !== 'granted') return;

            const unlockTime = new Date(capsule.unlockDate).getTime();
            const now = Date.now();
            const timeUntilUnlock = unlockTime - now;

            if (timeUntilUnlock > 0) {
                setTimeout(() => {
                    if (document.getElementById('unlockNotifications')?.checked !== false) {
                        new Notification('🎉 Time Capsule Unlocked!', {
                            body: `Your capsule "${capsule.title}" is now ready to view!`,
                            icon: '/favicon.ico',
                            requireInteraction: true
                        });
                    }
                }, timeUntilUnlock);

                // Reminder notification (1 day before)
                const reminderTime = timeUntilUnlock - (24 * 60 * 60 * 1000);
                if (reminderTime > 0) {
                    setTimeout(() => {
                        if (document.getElementById('reminderNotifications')?.checked !== false) {
                            new Notification('⏰ Time Capsule Reminder', {
                                body: `Your capsule "${capsule.title}" will unlock tomorrow!`,
                                icon: '/favicon.ico'
                            });
                        }
                    }, reminderTime);
                }
            }
        }

        function checkForUnlockedCapsules() {
            const now = new Date();
            capsules.forEach(capsule => {
                const unlockDate = new Date(capsule.unlockDate);
                if (now >= unlockDate && capsule.isLocked) {
                    capsule.isLocked = false;
                    
                    // Show notification
                    if (Notification.permission === 'granted' && document.getElementById('unlockNotifications')?.checked !== false) {
                        new Notification('🎉 Time Capsule Unlocked!', {
                            body: `Your capsule "${capsule.title}" is now ready to view!`,
                            icon: '/favicon.ico'
                        });
                    }
                }
            });
            localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
        }

        // Media Modal
        function openMediaModal(src, name, type) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90vw; max-height: 90vh; overflow: auto;">
                    <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                    <h3 style="margin-bottom: 20px; text-align: center;">${name}</h3>
                    ${type === 'image' ? 
                        `<img src="${src}" style="max-width: 100%; height: auto; border-radius: 10px;" alt="${name}">` :
                        `<video src="${src}" controls style="max-width: 100%; height: auto; border-radius: 10px;"></video>`
                    }
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
        }

        // Modals
        function showModal(modalId, message = '') {
            const modal = document.getElementById(modalId);
            if (message) {
                const messageEl = modal.querySelector('#successMessage, #errorMessage, #confirmMessage');
                if (messageEl) messageEl.textContent = message;
            }
            modal.classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Modal close button handlers
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal');
                modal.classList.remove('active');
            });
        });

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape to close modals
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal.active');
                if (openModal) {
                    openModal.classList.remove('active');
                }
            }
            
            // Ctrl/Cmd + N to create new capsule
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                navigateToPage('create');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelector('[data-page="create"]').classList.add('active');
            }
            
            // Ctrl/Cmd + H for home
            if ((e.ctrlKey || e.metaKey) && e.key === 'h') {
                e.preventDefault();
                navigateToPage('home');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelector('[data-page="home"]').classList.add('active');
            }
        });

        // Initialize demo data for first-time users
        function initializeDemoData() {
            if (capsules.length === 0 && !localStorage.getItem('chronovault_demo_loaded')) {
                const now = new Date();
                
                // Demo capsule that unlocks in 2 minutes
                const demoDate1 = new Date(now.getTime() + 2 * 60 * 1000);
                
                // Demo capsule that unlocks in 1 hour
                const demoDate2 = new Date(now.getTime() + 60 * 60 * 1000);
                
                const demoCapsules = [
                    {
                        id: 'demo-1-' + Date.now(),
                        title: 'Welcome to ChronoVault! 🎉',
                        message: 'Congratulations! You\'ve successfully created your first time capsule experience.\n\nThis demo capsule shows you how the platform works. You can create your own capsules with:\n• Personal messages and reflections\n• Photos, videos, and audio files\n• Password protection\n• Public or private visibility\n• Different categories for organization\n\nThis capsule unlocks in just 2 minutes so you can see the unlock experience right away!\n\nStart creating your own meaningful time capsules for the future. What will you tell your future self?',
                        unlockDate: demoDate1.toISOString(),
                        visibility: 'private',
                        password: '',
                        category: 'personal',
                        media: [],
                        createdAt: now.toISOString(),
                        isLocked: true
                    },
                    {
                        id: 'demo-2-' + Date.now(),
                        title: 'Future Goals & Dreams 🌟',
                        message: 'This is another demo capsule to show you different categories and longer unlock times.\n\nHere\'s what makes ChronoVault special:\n• Your capsules are truly time-locked - no early access!\n• Rich media support for complete memory preservation\n• Beautiful, futuristic interface that evolves with themes\n• Privacy-first approach - your data stays in your browser\n• Export/import functionality for data portability\n\nThis capsule unlocks in 1 hour. Try creating your own capsules with different unlock dates - maybe write a letter to yourself one year from now!\n\nRemember: the best time capsules contain authentic thoughts, dreams, and memories that will be meaningful to rediscover later.',
                        unlockDate: demoDate2.toISOString(),
                        visibility: 'public',
                        password: '',
                        category: 'goals',
                        media: [],
                        createdAt: now.toISOString(),
                        isLocked: true
                    }
                ];
                
                capsules.push(...demoCapsules);
                localStorage.setItem('chronovault_capsules', JSON.stringify(capsules));
                localStorage.setItem('chronovault_demo_loaded', 'true');
                
                // Schedule notifications for demo capsules
                demoCapsules.forEach(capsule => scheduleNotification(capsule));
            }
        }

        // Service Worker for offline functionality (basic implementation)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {
                // Silently fail if no service worker available
            });
        }

        // Auto-save form data as user types (for create form)
        function setupAutoSave() {
            const form = document.getElementById('createCapsuleForm');
            if (!form) return;

            const fields = ['capsuleTitle', 'capsuleMessage', 'unlockDate', 'visibility', 'password', 'category'];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', () => {
                        const formData = {};
                        fields.forEach(id => {
                            const element = document.getElementById(id);
                            if (element) formData[id] = element.value;
                        });
                        localStorage.setItem('chronovault_draft', JSON.stringify(formData));
                    });
                }
            });

            // Load saved draft
            const draft = localStorage.getItem('chronovault_draft');
            if (draft) {
                try {
                    const formData = JSON.parse(draft);
                    fields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field && formData[fieldId]) {
                            field.value = formData[fieldId];
                            if (fieldId === 'capsuleMessage') {
                                document.getElementById('charCount').textContent = `${formData[fieldId].length}/5000`;
                            }
                        }
                    });
                } catch (e) {
                    // Ignore invalid draft data
                }
            }
        }

        // Clear draft on successful form submission
        function clearDraft() {
            localStorage.removeItem('chronovault_draft');
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeDemoData();
            setupAutoSave();
            
            // Check for unlocked capsules every minute
            setInterval(checkForUnlockedCapsules, 60000);
        });

        // Update create form submission to clear draft
        const originalHandleCreateCapsule = handleCreateCapsule;
        handleCreateCapsule = function(e) {
            const result = originalHandleCreateCapsule.call(this, e);
            if (result !== false) {
                clearDraft();
            }
            return result;
        };

        // Add some visual polish - particle effects on hover
        function createParticleEffect(element) {
            const particles = [];
            const particleCount = 5;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '4px';
                particle.style.height = '4px';
                particle.style.background = 'var(--accent-color)';
                particle.style.borderRadius = '50%';
                particle.style.pointerEvents = 'none';
                particle.style.zIndex = '999';
                
                const rect = element.getBoundingClientRect();
                particle.style.left = (rect.left + Math.random() * rect.width) + 'px';
                particle.style.top = (rect.top + Math.random() * rect.height) + 'px';
                
                document.body.appendChild(particle);
                
                // Animate particle
                particle.animate([
                    { transform: 'translateY(0px)', opacity: 1 },
                    { transform: 'translateY(-30px)', opacity: 0 }
                ], {
                    duration: 1000,
                    easing: 'ease-out'
                }).onfinish = () => particle.remove();
            }
        }

        // Add particle effects to special buttons
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn-primary')) {
                createParticleEffect(e.target);
            }
        });

        // Enhanced error handling
        window.addEventListener('error', (e) => {
            console.error('ChronoVault Error:', e.error);
            // Could show a user-friendly error message here
        });

        // Add loading states for better UX
        function showLoading(element, text = 'Loading...') {
            const originalContent = element.innerHTML;
            element.disabled = true;
            element.innerHTML = `<div class="loading"></div> ${text}`;
            return () => {
                element.disabled = false;
                element.innerHTML = originalContent;
            };
        }

        // Performance optimization - lazy load heavy content
        function lazyLoadMedia() {
            const mediaElements = document.querySelectorAll('.media-preview[data-src]');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const media = entry.target;
                        media.src = media.dataset.src;
                        media.removeAttribute('data-src');
                        observer.unobserve(media);
                    }
                });
            });

            mediaElements.forEach(media => observer.observe(media));
        }

        // Call lazy loading after content updates
        const originalLoadCapsules = loadCapsules;
        loadCapsules = function() {
            originalLoadCapsules.call(this);
            setTimeout(lazyLoadMedia, 100);
        };

        // Add smooth scrolling for better navigation
        document.documentElement.style.scrollBehavior = 'smooth';

        // Analytics/usage tracking (privacy-friendly, local only)
        function trackUsage(action, category = 'general') {
            const usage = JSON.parse(localStorage.getItem('chronovault_usage') || '{}');
            const today = new Date().toISOString().split('T')[0];
            
            if (!usage[today]) usage[today] = {};
            if (!usage[today][category]) usage[today][category] = {};
            
            usage[today][category][action] = (usage[today][category][action] || 0) + 1;
            
            // Keep only last 30 days
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            Object.keys(usage).forEach(date => {
                if (new Date(date) < thirtyDaysAgo) {
                    delete usage[date];
                }
            });
            
            localStorage.setItem('chronovault_usage', JSON.stringify(usage));
        }

        // Track important actions
        const originalNavigateToPage = navigateToPage;
        navigateToPage = function(page) {
            trackUsage(`visit_${page}`, 'navigation');
            return originalNavigateToPage.call(this, page);
        };

        // Final initialization
        console.log('🎉 ChronoVault 2.0 initialized successfully!');
        console.log('💡 Tip: Use Ctrl/Cmd + N to quickly create a new capsule');
        console.log('⚡ Features: Time-locked capsules, rich media, themes, notifications');
    </script>
</body>
</html>
